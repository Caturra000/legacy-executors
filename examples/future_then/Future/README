Modified from my FluentNet library: https://github.com/Caturra000/FluentNet

Note: Concurrency correctness has not been fully verified!
